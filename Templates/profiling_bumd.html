{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <h1 class="mt-4">Profiling BUMD</h1>
    <div class="card">
        <div class="card-body">
            <button class="btn btn-primary mb-3" id="addDataBtn">Tambah Data</button>
            <div id="inputForm" style="display:none;">
                <form id="dataForm">
                    <div class="form-group">
                        <label for="nama_bumd">Nama BUMD</label>
                        <input type="text" class="form-control" id="nama_bumd" required>
                    </div>
                    <div class="form-group">
                        <label for="jenis_fraud">Jenis Fraud</label>
                        <input type="text" class="form-control" id="jenis_fraud" required>
                    </div>
                    <div class="form-group">
                        <label for="tahun_persidangan">Tahun Persidangan</label>
                        <input type="number" class="form-control" id="tahun_persidangan" required>
                    </div>
                    <div class="form-group">
                        <label for="status_kasus">Status Kasus</label>
                        <input type="text" class="form-control" id="status_kasus" required>
                    </div>
                    <div class="form-group">
                        <label for="no_sipp">No. SIPP</label>
                        <input type="text" class="form-control" id="no_sipp" required>
                    </div>
                    <div class="form-group">
                        <label for="tautan_putusan">Tautan Putusan</label>
                        <input type="url" class="form-control" id="tautan_putusan" required>
                    </div>
                    <button type="submit" class="btn btn-success">Simpan</button>
                </form>
            </div>
            <div class="table-responsive">
                <table id="example1" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Nama BUMD</th>
                            <th>Jenis Fraud</th>
                            <th>Tahun Persidangan</th>
                            <th>Status Kasus</th>
                            <th>No. SIPP</th>
                            <th>Tautan Putusan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data akan dimuat melalui AJAX -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.colVis.min.js"></script>

<script>
$(document).ready(function() {
    var table = $('#example1').DataTable({
        "ajax": "/api/data",
        "columns": [
            { "data": "Nama BUMD" },
            { "data": "Jenis Fraud" },
            { "data": "Tahun Persidangan" },
            { "data": "Status Kasus" },
            { "data": "No. SIPP" },
            { "data": "Tautan Putusan" }
        ],
        "dom": 'Bfrtip',
        "buttons": [
            'copy', 'csv', 'excel', 'pdf', 'print', 'colvis'
        ]
    });

    $('#addDataBtn').click(function() {
        $('#inputForm').toggle();
    });

    $('#dataForm').submit(function(event) {
        event.preventDefault();

        var formData = {
            "Nama BUMD": $('#nama_bumd').val(),
            "Jenis Fraud": $('#jenis_fraud').val(),
            "Tahun Persidangan": $('#tahun_persidangan').val(),
            "Status Kasus": $('#status_kasus').val(),
            "No. SIPP": $('#no_sipp').val(),
            "Tautan Putusan": $('#tautan_putusan').val()
        };

        $.ajax({
            url: "/api/add_data",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function(response) {
                alert("Data berhasil ditambahkan!");
                $('#dataForm')[0].reset();
                $('#inputForm').hide();
                table.ajax.reload();
            },
            error: function(error) {
                console.log("Error:", error);
                alert("Terjadi kesalahan saat menambahkan data.");
            }
        });
    });
});
</script>
{% endblock %}
